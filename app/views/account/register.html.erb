<h2><%=l(:label_register)%> <%=link_to l(:label_login_with_open_id_option), signin_url if Setting.openid? %></h2>

<% labelled_form_for @user, :url => {:action => 'register'} do |f| %>
<%= error_messages_for 'user' %>

<div class="box tabular">
<% if @user.auth_source_id.nil? %>
  <p><%= f.text_field :login, :size => 25, :required => true %></p>

  <p><%= f.password_field :password, :size => 25, :required => true %>
  <em class="info"><%= l(:text_caracters_minimum, :count => Setting.password_min_length) %></em></p>

  <p><%= f.password_field :password_confirmation, :size => 25, :required => true %></p>
<% end %>

<p><%= f.text_field :firstname, :required => true %></p>
<p><%= f.text_field :lastname, :required => true %></p>
<p>
  <% if @whitelisted_domains %>
    <%= label_tag t(:field_mail) + '<span class="required"> *</span>', nil %>
    <%= text_field_tag('user[mail_name]', @user.mail_name) %>@
    <%= select_tag 'user[mail_domain]', options_from_collection_for_select(@whitelisted_domains, 'to_s', 'to_s', @user.mail_domain) %>
    <p><%= @mail_banner_message %></p>
  <% else %>
    <p><%= f.text_field :mail, :required => true %></p>
  <% end %>
</p>
<p><%= f.select :language, lang_options_for_select %></p>

<% if Setting.openid? %>
  <p><%= f.text_field :identity_url  %></p>
<% end %>

<% @user.custom_field_values.select {|v| v.editable? || v.required?}.each do |value| %>
  <p><%= custom_field_tag_with_label :user, value %></p>
<% end %>
</div>

<%= submit_tag l(:button_submit) %>
<% end %>
